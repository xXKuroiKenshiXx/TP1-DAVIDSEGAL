"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7592],{112:(F,E,p)=>{p.r(E),p.d(E,{ProfilePage:()=>v});var d=p(467),x=p(177),w=p(2780),g=p(4341),T=p(5083),I=function(l){return l.Prompt="PROMPT",l.Camera="CAMERA",l.Photos="PHOTOS",l}(I||{}),_=function(l){return l.Rear="REAR",l.Front="FRONT",l}(_||{}),U=function(l){return l.Uri="uri",l.Base64="base64",l.DataUrl="dataUrl",l}(U||{});class P extends T.E_{getPhoto(a){var r=this;return(0,d.A)(function*(){return new Promise(function(){var o=(0,d.A)(function*(n,s){if(a.webUseInput||a.source===I.Photos)r.fileInputExperience(a,n,s);else if(a.source===I.Prompt){let u=document.querySelector("pwa-action-sheet");u||(u=document.createElement("pwa-action-sheet"),document.body.appendChild(u)),u.header=a.promptLabelHeader||"Photo",u.cancelable=!1,u.options=[{title:a.promptLabelPhoto||"From Photos"},{title:a.promptLabelPicture||"Take Picture"}],u.addEventListener("onSelection",function(){var m=(0,d.A)(function*(h){0===h.detail?r.fileInputExperience(a,n,s):r.cameraExperience(a,n,s)});return function(h){return m.apply(this,arguments)}}())}else r.cameraExperience(a,n,s)});return function(n,s){return o.apply(this,arguments)}}())})()}pickImages(a){var r=this;return(0,d.A)(function*(){return new Promise(function(){var o=(0,d.A)(function*(n,s){r.multipleFileInputExperience(n,s)});return function(n,s){return o.apply(this,arguments)}}())})()}cameraExperience(a,r,o){var n=this;return(0,d.A)(function*(){if(customElements.get("pwa-camera-modal")){const s=document.createElement("pwa-camera-modal");s.facingMode=a.direction===_.Front?"user":"environment",document.body.appendChild(s);try{yield s.componentOnReady(),s.addEventListener("onPhoto",function(){var u=(0,d.A)(function*(m){const h=m.detail;null===h?o(new T.I9("User cancelled photos app")):h instanceof Error?o(h):r(yield n._getCameraPhoto(h,a)),s.dismiss(),document.body.removeChild(s)});return function(m){return u.apply(this,arguments)}}()),s.present()}catch{n.fileInputExperience(a,r,o)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),n.fileInputExperience(a,r,o)})()}fileInputExperience(a,r,o){let n=document.querySelector("#_capacitor-camera-input");const s=()=>{var u;null===(u=n.parentNode)||void 0===u||u.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input",n.type="file",n.hidden=!0,document.body.appendChild(n),n.addEventListener("change",u=>{const m=n.files[0];let h="jpeg";if("image/png"===m.type?h="png":"image/gif"===m.type&&(h="gif"),"dataUrl"===a.resultType||"base64"===a.resultType){const k=new FileReader;k.addEventListener("load",()=>{if("dataUrl"===a.resultType)r({dataUrl:k.result,format:h});else if("base64"===a.resultType){const R=k.result.split(",")[1];r({base64String:R,format:h})}s()}),k.readAsDataURL(m)}else r({webPath:URL.createObjectURL(m),format:h}),s()}),n.addEventListener("cancel",u=>{o(new T.I9("User cancelled photos app")),s()})),n.accept="image/*",n.capture=!0,a.source===I.Photos||a.source===I.Prompt?n.removeAttribute("capture"):a.direction===_.Front?n.capture="user":a.direction===_.Rear&&(n.capture="environment"),n.click()}multipleFileInputExperience(a,r){let o=document.querySelector("#_capacitor-camera-input-multiple");const n=()=>{var s;null===(s=o.parentNode)||void 0===s||s.removeChild(o)};o||(o=document.createElement("input"),o.id="_capacitor-camera-input-multiple",o.type="file",o.hidden=!0,o.multiple=!0,document.body.appendChild(o),o.addEventListener("change",s=>{const u=[];for(let m=0;m<o.files.length;m++){const h=o.files[m];let k="jpeg";"image/png"===h.type?k="png":"image/gif"===h.type&&(k="gif"),u.push({webPath:URL.createObjectURL(h),format:k})}a({photos:u}),n()}),o.addEventListener("cancel",s=>{r(new T.I9("User cancelled photos app")),n()})),o.accept="image/*",o.click()}_getCameraPhoto(a,r){return new Promise((o,n)=>{const s=new FileReader,u=a.type.split("/")[1];"uri"===r.resultType?o({webPath:URL.createObjectURL(a),format:u,saved:!1}):(s.readAsDataURL(a),s.onloadend=()=>{const m=s.result;o("dataUrl"===r.resultType?{dataUrl:m,format:u,saved:!1}:{base64String:m.split(",")[1],format:u,saved:!1})},s.onerror=m=>{n(m)})})}checkPermissions(){var a=this;return(0,d.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw a.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw a.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var a=this;return(0,d.A)(function*(){throw a.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var a=this;return(0,d.A)(function*(){throw a.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var a=this;return(0,d.A)(function*(){throw a.unavailable("Not implemented on web.")})()}}new P;const j=(0,T.F3)("Camera",{web:()=>new P});var e=p(3953),f=p(5260),y=p(2739),t=p(8880);function i(l,a){1&l&&e.eu8(0)}function c(l,a){if(1&l){const r=e.RV6();e.qex(0),e.j41(1,"ion-item",2)(2,"ion-avatar",3),e.nrm(3,"img",4),e.k0s(),e.j41(4,"div",5)(5,"h2",6),e.EFF(6),e.k0s(),e.j41(7,"ion-label"),e.EFF(8),e.k0s(),e.j41(9,"ion-label"),e.EFF(10),e.k0s(),e.j41(11,"ion-label"),e.EFF(12),e.k0s()()(),e.j41(13,"ion-button",7),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.isEditing=!0)}),e.EFF(14,"Editar Perfil"),e.k0s(),e.bVm()}if(2&l){const r=e.XpG();e.R7$(3),e.Y8G("src",null!=r.userProfile&&r.userProfile.imagen?"data:image/jpeg;base64,"+(null==r.userProfile?null:r.userProfile.imagen):"https://ionicframework.com/docs/img/demos/avatar.svg",e.B4B),e.R7$(3),e.JRh(null==r.userProfile?null:r.userProfile.username),e.R7$(2),e.JRh(null==r.userProfile?null:r.userProfile.nombre),e.R7$(2),e.JRh(null==r.userProfile?null:r.userProfile.email),e.R7$(2),e.JRh(null==r.userProfile?null:r.userProfile.bio)}}function b(l,a){if(1&l&&(e.j41(0,"div"),e.nrm(1,"img",20),e.k0s()),2&l){const r=e.XpG(2);e.R7$(),e.Y8G("src",r.photo,e.B4B)}}function S(l,a){if(1&l){const r=e.RV6();e.qex(0),e.j41(1,"form",8),e.bIt("ngSubmit",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.onSaveProfile())}),e.j41(2,"ion-item")(3,"ion-label",9),e.EFF(4,"Username"),e.k0s(),e.nrm(5,"ion-input",10),e.k0s(),e.j41(6,"ion-item")(7,"ion-label",9),e.EFF(8,"Nombre"),e.k0s(),e.nrm(9,"ion-input",11),e.k0s(),e.j41(10,"ion-item")(11,"ion-label",9),e.EFF(12,"Biograf\xeda"),e.k0s(),e.nrm(13,"ion-textarea",12),e.k0s(),e.j41(14,"ion-item")(15,"ion-label",9),e.EFF(16,"Email"),e.k0s(),e.nrm(17,"ion-input",13),e.k0s(),e.j41(18,"ion-item")(19,"ion-label",9),e.EFF(20,"Password"),e.k0s(),e.nrm(21,"ion-input",14),e.k0s(),e.j41(22,"ion-item")(23,"ion-label",9),e.EFF(24,"Confirmar password"),e.k0s(),e.nrm(25,"ion-input",15),e.k0s(),e.j41(26,"ion-item",16)(27,"ion-button",17),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.takePicture())}),e.EFF(28,"Tomar foto"),e.k0s(),e.DNE(29,b,2,1,"div",0),e.k0s(),e.j41(30,"ion-button",18),e.EFF(31,"Guardar Perfil"),e.k0s(),e.j41(32,"ion-button",19),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.isEditing=!1)}),e.EFF(33,"Cancelar"),e.k0s()(),e.bVm()}if(2&l){const r=e.XpG();e.R7$(),e.Y8G("formGroup",r.profileForm),e.R7$(28),e.Y8G("ngIf",r.photo)}}let v=(()=>{class l{constructor(r,o,n,s){this.fb=r,this.router=o,this.usersService=n,this.platform=s,this.showImageUpload=!1,this.isEditing=!1,this.userProfile=this.loadUserProfile(),this.currentUserId=this.usersService.getCurrentUserId()}ngOnInit(){this.loadUserProfile()}takePicture(){var r=this;return(0,d.A)(function*(){let o;if(r.platform.is("ios")||r.platform.is("android"))o=yield j.getPhoto({quality:90,allowEditing:!1,resultType:U.Base64,source:I.Prompt});else if(r.platform.is("desktop")||r.platform.is("mobileweb"))if(o=yield j.getPhoto({quality:90,allowEditing:!1,resultType:U.Base64,source:I.Camera}),o&&o.base64String){const n=o.base64String;if(.75*n?.length>1048576)return void alert("La imagen seleccionada es demasiado grande. El l\xedmite es de 1MB.");const u=n.substring(0,11);if("data:image/jpeg"!==u&&"data:image/jpg"!==u&&!u.startsWith("/9j/4AAQSkZ")||u.startsWith("iVBORw0KGgo"))return void alert("Por favor, suba una imagen en formato JPEG.");r.photo="data:image/jpeg;base64,"+n,r.profileForm.patchValue({imagen:o.base64String})}else alert("No se encontraron datos de una imagen. Por favor, intente de nuevo.")})()}loadUserProfile(){this.currentUserId?this.usersService.getUser(this.currentUserId).subscribe(r=>(this.userProfile=r,this.profileForm=this.fb.group({idUsuario:Number(this.currentUserId),username:[this.userProfile?.username,[g.k0.minLength(4),g.k0.maxLength(32)]],password:["",[g.k0.minLength(4),g.k0.pattern("^[a-zA-Z0-9._%+-]+"),g.k0.maxLength(255)]],confirmPassword:["",[g.k0.minLength(4)]],nombre:[this.userProfile?.nombre,[g.k0.minLength(2),g.k0.maxLength(255)]],email:[this.userProfile?.email,[g.k0.email,g.k0.maxLength(255)]],imagen:[this.userProfile?.imagen],bio:[this.userProfile?.bio,[g.k0.maxLength(2e3)]],rol:[""]},{validators:this.passwordMatchValidator}),this.userProfile),r=>{console.error("Hubo un error al obtener los datos del usuario:",r)}):console.error("No se encontr\xf3 un usuario logueado. \xbfC\xf3mo llegaste ac\xe1?")}passwordMatchValidator(r){const o=r.get("password")?.value,n=r.get("confirmPassword")?.value;return o===n?null:{mismatch:!0}}onSaveProfile(){var r=this;return(0,d.A)(function*(){if(r.profileForm.invalid)return void r.profileForm.markAllAsTouched();const{idUsuario:o,username:n,password:s,nombre:u,imagen:m,email:h,bio:k,rol:R}=r.profileForm.value;try{yield r.usersService.updateUser(r.currentUserId,{idUsuario:o,username:n,password:s,nombre:u,email:h,imagen:m,bio:k,rol:R}).toPromise(),alert(`Perfil actualizado: ${n} (${h})`)}catch(C){console.error(C),alert("No se pudo actualizar el perfil")}r.loadUserProfile()})()}static#e=this.\u0275fac=function(o){return new(o||l)(e.rXU(g.ok),e.rXU(f.Ix),e.rXU(y.g),e.rXU(t.OD))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["app-profile"]],standalone:!0,features:[e.aNF],decls:9,vars:3,consts:[[4,"ngIf"],[1,"profile-container"],["lines","none",1,"avatar-container"],[1,"profile-avatar"],["alt","Imagen de Perfil",3,"src"],[1,"profile-info"],[1,"profile-name"],["expand","block","fill","clear",1,"edit-button",3,"click"],[1,"form-container",3,"ngSubmit","formGroup"],["position","floating"],["type","text","placeholder","Ingresa tu nombre de usuario","formControlName","username"],["type","text","placeholder","Ingresa tu nombre","formControlName","nombre"],["placeholder","Me gusta...","formControlName","bio"],["type","email","placeholder","address@mail.com","formControlName","email"],["type","password","placeholder","Password","formControlName","password"],["type","password","placeholder","Confimar password","formControlName","confirmPassword"],[1,"ion-padding"],[3,"click"],["expand","block","type","submit",1,"save-button"],["expand","block","fill","clear",3,"click"],[3,"src"]],template:function(o,n){1&o&&(e.j41(0,"ion-content"),e.DNE(1,i,1,0,"ng-container",0),e.j41(2,"ion-header")(3,"ion-toolbar")(4,"ion-title"),e.EFF(5,"Perfil"),e.k0s()()(),e.j41(6,"div",1),e.DNE(7,c,15,5,"ng-container",0)(8,S,34,2,"ng-container",0),e.k0s()()),2&o&&(e.R7$(),e.Y8G("ngIf",n.showImageUpload),e.R7$(6),e.Y8G("ngIf",!n.isEditing),e.R7$(),e.Y8G("ngIf",n.isEditing))},dependencies:[w.nc,w.uz,w.he,w.$w,w.W9,w.eU,w.BC,w.ai,w.Jm,w.mC,x.MD,x.bT,g.X1,g.qT,g.BC,g.cb,g.j4,g.JD],styles:['@charset "UTF-8";.profile-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;padding:20px;max-width:100%;text-align:center}.profile-avatar[_ngcontent-%COMP%]{width:150px;height:150px;margin-bottom:20px}.profile-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.profile-name[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin:10px 0;font-family:Helvetica Neue,sans-serif}.edit-button[_ngcontent-%COMP%]{font-size:1rem;color:#007bff;background-color:#fff;padding:10px 20px;border-radius:5px;border:1px solid #007bff;cursor:pointer;margin-top:10px}.form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;max-width:400px;background-color:#fff;box-shadow:0 4px 8px #0003;border-radius:8px;padding:10px;margin-top:20px}.save-button[_ngcontent-%COMP%]{margin-top:20px;padding:10px 20px}.form-container[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{padding-bottom:1.3vh}@media (max-width: 768px){.profile-avatar[_ngcontent-%COMP%]{width:120px;height:120px}.profile-container[_ngcontent-%COMP%]{padding:20px;width:100%}.edit-button[_ngcontent-%COMP%]{font-size:.9rem}}']})}return l})()},5379:(F,E,p)=>{p.d(E,{$:()=>d});var d=function(x){return x.ADMINISTRADOR="Administrador",x.USUARIO="Usuario",x.INVITADO="Invitado",x}(d||{})},5375:(F,E,p)=>{p.d(E,{u:()=>e});var d=p(3953);const x=new d.nKC("JWT_OPTIONS");let w=(()=>{class f{constructor(t=null){this.tokenGetter=t&&t.tokenGetter||function(){}}urlBase64Decode(t){let i=t.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(i)}b64decode(t){let c="";if((t=String(t).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let S,v,b=0,l=0;v=t.charAt(l++);~v&&(S=b%4?64*S+v:v,b++%4)?c+=String.fromCharCode(255&S>>(-2*b&6)):0)v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(v);return c}b64DecodeUnicode(t){return decodeURIComponent(Array.prototype.map.call(this.b64decode(t),i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(t=this.tokenGetter()){return t instanceof Promise?t.then(i=>this._decodeToken(i)):this._decodeToken(t)}_decodeToken(t){if(!t||""===t)return null;const i=t.split(".");if(3!==i.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const c=this.urlBase64Decode(i[1]);if(!c)throw new Error("Cannot decode the token.");return JSON.parse(c)}getTokenExpirationDate(t=this.tokenGetter()){return t instanceof Promise?t.then(i=>this._getTokenExpirationDate(i)):this._getTokenExpirationDate(t)}_getTokenExpirationDate(t){let i;if(i=this.decodeToken(t),!i||!i.hasOwnProperty("exp"))return null;const c=new Date(0);return c.setUTCSeconds(i.exp),c}isTokenExpired(t=this.tokenGetter(),i){return t instanceof Promise?t.then(c=>this._isTokenExpired(c,i)):this._isTokenExpired(t,i)}_isTokenExpired(t,i){if(!t||""===t)return!0;const c=this.getTokenExpirationDate(t);return i=i||0,null!==c&&!(c.valueOf()>(new Date).valueOf()+1e3*i)}getAuthScheme(t,i){return"function"==typeof t?t(i):t}}return f.\u0275fac=function(t){return new(t||f)(d.KVO(x))},f.\u0275prov=d.jDH({token:f,factory:f.\u0275fac}),f})();var _=p(4412),U=p(8141),P=p(5379),O=p(1626),j=p(5260);let e=(()=>{class f{constructor(t,i){this.client=t,this.router=i,this.isLoggedInSubject=new _.t(!1),this.isLoggedIn$=this.isLoggedInSubject.asObservable(),this.isLoggedInSubject.next(this.hasToken())}login(t,i){return this.client.post("http://localhost:3000/api/auth/login",{email:t,password:i}).pipe((0,U.M)(b=>{this.setSession(b.token),localStorage.setItem("userId",String(b.idUsuario)),this.isLoggedInSubject.next(!0)}))}getSessionToken(){return typeof sessionStorage<"u"&&sessionStorage.getItem("token")||""}setSession(t){typeof sessionStorage<"u"&&sessionStorage.setItem("token",t)}register(t,i,c){return this.client.post("http://localhost:3000/api/usuarios",{username:t,email:i,password:c,rol:"Usuario"})}updateProfile(t){return this.client.put("http://localhost:3000/api/usuarios",t)}logout(){typeof sessionStorage<"u"&&sessionStorage.removeItem("token"),this.isLoggedInSubject.next(!1),this.router.navigateByUrl("login")}isLoggedIn(){return this.isLoggedInSubject.value}hasToken(){if(typeof sessionStorage>"u")return!1;const t=sessionStorage.getItem("token");return!!t&&!(new w).isTokenExpired(t)}hasRole(t){if(typeof sessionStorage>"u")return!1;const i=sessionStorage.getItem("token");return!!i&&(new w).decodeToken(i).rol===t}getUserRole(){if(typeof sessionStorage>"u")return P.$.INVITADO;const t=sessionStorage.getItem("token");if(!t)return P.$.INVITADO;const c=(new w).decodeToken(t);switch(String(c.rol).toLocaleLowerCase()){case String(P.$.ADMINISTRADOR).toLocaleLowerCase():return P.$.ADMINISTRADOR;case String(P.$.USUARIO).toLocaleLowerCase():return P.$.USUARIO}return c.rol}getUser(){if(typeof sessionStorage>"u")return{id:null,rol:P.$.INVITADO};const t=sessionStorage.getItem("token");if(!t)return{id:null,rol:P.$.INVITADO};const c=(new w).decodeToken(t);return{id:parseInt(c.sub),rol:String(c.rol).toLocaleLowerCase()}}static#e=this.\u0275fac=function(i){return new(i||f)(d.KVO(O.Qq),d.KVO(j.Ix))};static#t=this.\u0275prov=d.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()}}]);